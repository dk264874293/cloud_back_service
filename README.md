<div align="center">

# äº‘ä¸Šç½‘ç‚¹å¹³å°åç«¯

**è¿æ¥ç”¨æˆ·ã€æœåŠ¡å•†ã€é“¶è¡Œçš„é‡‘èéœ€æ±‚åŒ¹é…å¹³å°**

[![NestJS](https://img.shields.io/badge/NestJS-11.0-e0234e?logo=nestjs)](https://nestjs.com/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.7-blue?logo=typescript)](https://www.typescriptlang.org/)
[![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?logo=mysql)](https://www.mysql.com/)
[![License](https://img.shields.io/badge/License-UNLICENSED-red)](LICENSE)

</div>

## ğŸ“– é¡¹ç›®ç®€ä»‹

äº‘ä¸Šç½‘ç‚¹å¹³å°æ˜¯ä¸€ä¸ªè¿æ¥ç”¨æˆ·ã€æœåŠ¡å•†ã€é“¶è¡Œçš„é‡‘èéœ€æ±‚åŒ¹é…å¹³å°åç«¯ç³»ç»Ÿã€‚å¹³å°æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **ç”¨æˆ·ç«¯**ï¼šå‘å¸ƒé‡‘èéœ€æ±‚ï¼ˆè´·æ¬¾/å­˜æ¬¾/ç†è´¢ï¼‰ã€æŸ¥çœ‹è®¢å•ã€æç°ã€é‚€è¯·å¥½å‹
- **æœåŠ¡å•†ç«¯**ï¼šæ¥ç®¡è®¢å•ã€éœ€æ±‚æ¢³ç†ã€ä¸Šä¼ å®¢æˆ·æŠ¥å‘Šã€çº¿ä¸‹å¯¹æ¥é“¶è¡Œ
- **é“¶è¡Œç«¯**ï¼šè´­ä¹°è®¢å•ã€æŸ¥çœ‹éœ€æ±‚æŠ¥å‘Šã€çº¿ä¸‹æ²Ÿé€šã€åé¦ˆå®¡æ‰¹ç»“æœ
- **è¿è¥ç«¯**ï¼šå®¢æˆ·ç®¡ç†ã€æœåŠ¡å•†ç®¡ç†ï¼ˆæ”¯æŒå¤šå±‚çº§æŸ¥è¯¢ï¼‰ã€è®¢å•ç®¡ç†ã€åˆ†ä½£é…ç½®ã€æ•°æ®ç»Ÿè®¡

### æ ¸å¿ƒä¸šåŠ¡æµç¨‹

```
ç”¨æˆ·å‘å¸ƒéœ€æ±‚
    â†“
åˆ†é…ç®¡æˆ·äººï¼ˆè‡ªç„¶å®¢æˆ·éšæœºåˆ†é… / æ¸ é“å®¢æˆ·è‡ªåŠ¨ç»‘å®šï¼‰
    â†“
éœ€æ±‚æ¢³ç†ï¼ˆç®¡æˆ·äººè‡ªè¡Œæ‰¿æ¥æˆ–æ´¾å•æ± åˆ†é…è®¿è°ˆäººï¼‰
    â†“
ä¸Šä¼ å®¢æˆ·éœ€æ±‚æŠ¥å‘Šï¼ˆPDF/å›¾ç‰‡ï¼‰
    â†“
è¿è¥è®¾ç½®ä»·æ ¼å’Œæ´¾å•é“¶è¡Œ
    â†“
è®¢å•ä¸Šæ¶é“¶è¡Œç«¯ï¼ˆè„±æ•å±•ç¤ºéœ€æ±‚æ¦‚è¦ï¼‰
    â†“
é“¶è¡Œå®¢æˆ·ç»ç†è´­ä¹°è®¢å•ï¼ˆæ”¯ä»˜è´¹ç”¨ï¼‰
    â†“
æŸ¥çœ‹ç®¡æˆ·äººè”ç³»æ–¹å¼ï¼Œçº¦å®šçº¿ä¸‹æ²Ÿé€š
    â†“
ç®¡æˆ·äººå‘èµ·ç°åœºç¡®è®¤
    â†“
é“¶è¡Œå®¢æˆ·ç»ç†çº¿ä¸Šç¡®è®¤ï¼ˆè´¹ç”¨ä¸å¯é€€ï¼‰
    â†“
ç”¨æˆ·é€‰æ‹©åˆä½œé“¶è¡Œ
    â†“
ï¼ˆå¯é€‰ï¼‰å‘èµ·å§”æ‰˜è®¢å• â†’ ä¸šåŠ¡å—ç†äººå¯¹æ¥é“¶è¡ŒåŠç†æ‰‹ç»­
```

### æœåŠ¡å•†å¤šå±‚çº§ç»“æ„

**æœåŠ¡å•†ç±»å‹å±‚çº§**ï¼ˆåŠ ç›Ÿå•† â†’ æ¸ é“å•† â†’ æœåŠ¡å•†ï¼‰ï¼š

- **FRANCHISEï¼ˆåŠ ç›Ÿå•†ï¼‰**ï¼šå±‚çº§ 0ï¼Œæ ¹èŠ‚ç‚¹ï¼Œåªèƒ½åˆ›å»º CHANNEL ç±»å‹å­èŠ‚ç‚¹
- **CHANNELï¼ˆæ¸ é“å•†ï¼‰**ï¼šå±‚çº§ 1ï¼Œå½’å± FRANCHISEï¼Œåªèƒ½åˆ›å»º SERVICE_PROVIDER ç±»å‹å­èŠ‚ç‚¹
- **SERVICE_PROVIDERï¼ˆæœåŠ¡å•†ï¼‰**ï¼šå±‚çº§ 2ï¼Œå½’å± CHANNELï¼Œä¸èƒ½åˆ›å»ºå­èŠ‚ç‚¹ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰

**å±‚çº§å­—æ®µè¯´æ˜**ï¼š

- `level`: å±‚çº§æ·±åº¦ï¼ˆ0=åŠ ç›Ÿå•†, 1=æ¸ é“å•†, 2=æœåŠ¡å•†ï¼‰
- `path`: ç‰©åŒ–è·¯å¾„ï¼ˆå¦‚ "1/3/7" è¡¨ç¤ºä»æ ¹åˆ°è¯¥èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ï¼‰
- `rootId`: æ ¹èŠ‚ç‚¹ IDï¼ˆç”¨äºå¿«é€ŸæŸ¥è¯¢åŒä¸€æ£µæ ‘çš„æ‰€æœ‰èŠ‚ç‚¹ï¼‰
- `parent_id`: ä¸Šçº§èŠ‚ç‚¹ IDï¼ˆä½¿ç”¨é‚»æ¥è¡¨æ¨¡å‹ï¼‰

**æ€§èƒ½ä¼˜åŒ–**ï¼š

- âœ… 4 ä¸ªæ€§èƒ½ç´¢å¼•ï¼ˆparent_idã€pathã€root_idã€type+parentï¼‰
- âœ… WITH RECURSIVE é€’å½’æŸ¥è¯¢ï¼ˆMySQL 8.0+ åŸç”Ÿæ”¯æŒï¼‰
- âœ… Redis ç¼“å­˜é›†æˆï¼ˆ5 åˆ†é’Ÿ TTLï¼Œå‡å°‘æ•°æ®åº“è®¿é—®ï¼‰

**ç±»å‹çº¦æŸ**ï¼š

- âœ… ä¸¥æ ¼çš„ç±»å‹å±‚çº§è§„åˆ™éªŒè¯
- âœ… ç¦æ­¢èŠ‚ç‚¹ç§»åŠ¨ï¼ˆåˆ›å»ºåä¸å…è®¸æ›´æ¢çˆ¶èŠ‚ç‚¹ï¼‰
- âœ… æ ¹èŠ‚ç‚¹å¿…é¡»æ˜¯ FRANCHISE ç±»å‹

**å±‚çº§æŸ¥è¯¢åŠŸèƒ½**ï¼š

- âœ… è·å–æ‰€æœ‰åä»£èŠ‚ç‚¹ï¼ˆé€’å½’æŸ¥è¯¢ï¼Œæ”¯æŒä»»æ„æ·±åº¦ï¼‰
- âœ… è·å–æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼ˆé€’å½’æŸ¥è¯¢ï¼Œæ”¯æŒä»»æ„æ·±åº¦ï¼‰
- âœ… è·å–ä»æ ¹åˆ°èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„ï¼ˆO(1) æŸ¥è¯¢ï¼‰
- âœ… æŒ‰ç±»å‹ç»Ÿè®¡å­èŠ‚ç‚¹æ•°é‡
- âœ… Redis ç¼“å­˜é›†æˆï¼ˆ5 åˆ†é’Ÿ TTLï¼Œæå‡æŸ¥è¯¢æ€§èƒ½ï¼‰

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ” **JWTåŒä»¤ç‰Œè®¤è¯** - æ”¯æŒaccess_tokenå’Œrefresh_tokenæœºåˆ¶
- ğŸ‘¥ **å¤šè§’è‰²æƒé™æ§åˆ¶** - ç”¨æˆ·/æœåŠ¡å•†/é“¶è¡Œ/ç®¡ç†å‘˜å››ç§è§’è‰²ï¼Œç»†ç²’åº¦æƒé™ç®¡ç†
- ğŸ“ **è®¢å•çŠ¶æ€æœº** - å®Œæ•´çš„è®¢å•çŠ¶æ€æµè½¬ä¸æ—¥å¿—è®°å½•
- ğŸ’° **æ™ºèƒ½åˆ†ä½£ç³»ç»Ÿ** - å¯é…ç½®çš„åˆ†ä½£è§„åˆ™ï¼Œæ”¯æŒå¤šå±‚çº§ä½£é‡‘åˆ†é…
- ğŸ’³ **å¾®ä¿¡æ”¯ä»˜é›†æˆ** - æ”¯æŒJSAPIå’ŒNativeæ”¯ä»˜æ–¹å¼
- ğŸ“ **æ–‡ä»¶ä¸Šä¼ ç®¡ç†** - é˜¿é‡Œäº‘OSSé›†æˆï¼Œæ”¯æŒPDF/å›¾ç‰‡ä¸Šä¼ 
- ğŸ”’ **æ•°æ®è„±æ•** - æ•æ„Ÿä¿¡æ¯è‡ªåŠ¨è„±æ•å¤„ç†
- ğŸ“Š **æ“ä½œæ—¥å¿—** - å®Œæ•´çš„æ“ä½œè®°å½•ä¸å®¡è®¡è¿½è¸ª
- ğŸ“˜ **Swagger APIæ–‡æ¡£** - è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼APIæ–‡æ¡£
- âœ… **ç±»å‹å®‰å…¨** - TypeScriptä¸¥æ ¼æ¨¡å¼ï¼Œå®Œæ•´çš„ç±»å‹å®šä¹‰

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æ¡†æ¶

- [NestJS](https://nestjs.com/) - æ¸è¿›å¼Node.jsæ¡†æ¶
- [TypeScript](https://www.typescriptlang.org/) - JavaScriptè¶…é›†
- [TypeORM](https://typeorm.io/) - ORMæ¡†æ¶
- [MySQL](https://www.mysql.com/) - å…³ç³»å‹æ•°æ®åº“

### è®¤è¯æˆæƒ

- [@nestjs/jwt](https://github.com/nestjs/jwt) - JWTè®¤è¯
- [passport](http://www.passportjs.org/) - è®¤è¯ä¸­é—´ä»¶
- [bcrypt](https://github.com/kelektiv/node.bcrypt.js) - å¯†ç åŠ å¯†

### éªŒè¯ä¸æ–‡æ¡£

- [class-validator](https://github.com/typestack/class-validator) - DTOéªŒè¯
- [class-transformer](https://github.com/typestack/class-transformer) - å¯¹è±¡è½¬æ¢
- [@nestjs/swagger](https://github.com/nestjs/swagger) - APIæ–‡æ¡£ç”Ÿæˆ

### ç¬¬ä¸‰æ–¹é›†æˆ

- [mysql2](https://github.com/sidorares/node-mysql2) - MySQLé©±åŠ¨
- [wechatpay-node-v3](https://github.com/wechatpay-apiv3/wechatpay-node-v3) - å¾®ä¿¡æ”¯ä»˜SDK
- [ali-oss](https://github.com/ali-sdk/ali-oss) - é˜¿é‡Œäº‘OSS

### å¼€å‘å·¥å…·

- [Jest](https://jestjs.io/) - å•å…ƒæµ‹è¯•æ¡†æ¶
- [ESLint](https://eslint.org/) - ä»£ç æ£€æŸ¥
- [Prettier](https://prettier.io/) - ä»£ç æ ¼å¼åŒ–

## ğŸ“ é¡¹ç›®ç»“æ„

```
yinhang/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts                      # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ app.module.ts                # æ ¹æ¨¡å—
â”‚   â”œâ”€â”€ common/                      # å…¬å…±æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ decorators/              # è‡ªå®šä¹‰è£…é¥°å™¨ (@Roles, @CurrentUserç­‰)
â”‚   â”‚   â”œâ”€â”€ dto/                     # å…¬å…±DTO (åˆ†é¡µã€å“åº”ç­‰)
â”‚   â”‚   â”œâ”€â”€ enums/                   # æšä¸¾å®šä¹‰ (ç”¨æˆ·è§’è‰²ã€è®¢å•çŠ¶æ€ç­‰)
â”‚   â”‚   â”œâ”€â”€ filters/                 # å¼‚å¸¸è¿‡æ»¤å™¨
â”‚   â”‚   â”œâ”€â”€ guards/                  # å®ˆå« (JWTè®¤è¯ã€è§’è‰²éªŒè¯)
â”‚   â”‚   â”œâ”€â”€ interceptors/            # æ‹¦æˆªå™¨
â”‚   â”‚   â”œâ”€â”€ middleware/              # ä¸­é—´ä»¶
â”‚   â”‚   â””â”€â”€ utils/                   # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ config/                      # é…ç½®æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config.module.ts
â”‚   â”‚   â”œâ”€â”€ config.service.ts
â”‚   â”‚   â”œâ”€â”€ config.interface.ts
â”‚   â”‚   â””â”€â”€ typeorm.config.ts
â”‚   â”œâ”€â”€ database/                    # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ migrations/              # æ•°æ®åº“è¿ç§»æ–‡ä»¶
â”‚   â”‚   â””â”€â”€ seeds/                   # ç§å­æ•°æ®
â”‚   â””â”€â”€ modules/                     # ä¸šåŠ¡æ¨¡å—
â”‚       â”œâ”€â”€ auth/                    # è®¤è¯æ¨¡å— (æ³¨å†Œ/ç™»å½•/åˆ·æ–°ä»¤ç‰Œã€ç™»å‡º)
â”‚       â”‚   â”œâ”€â”€ auth.controller.ts
â”‚       â”‚   â”œâ”€â”€ auth.service.ts
â”‚       â”‚   â”œâ”€â”€ strategies/
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ user/                    # ç”¨æˆ·æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ user.controller.ts
â”‚       â”‚   â”œâ”€â”€ user.service.ts
â”‚       â”‚   â”œâ”€â”€ user.entity.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ order/                   # è®¢å•æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ order.controller.ts
â”‚       â”‚   â”œâ”€â”€ order.service.ts
â”‚       â”‚   â”œâ”€â”€ order-status.service.ts
â”‚       â”‚   â”œâ”€â”€ entities/
â”‚       â”‚   â”‚   â”œâ”€â”€ connection-order.entity.ts      # å¯¹æ¥è®¢å•
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ entrustment-order.entity.ts     # å§”æ‰˜è®¢å•
â”‚       â”‚   â”‚   â””â”€â”€ order-log.entity.ts             # è®¢å•æ—¥å¿—
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ payment/                 # æ”¯ä»˜æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ payment.controller.ts
â”‚       â”‚   â”œâ”€â”€ payment.service.ts
â”‚       â”‚   â”œâ”€â”€ wechat-pay.service.ts
â”‚       â”‚   â”œâ”€â”€ payment.entity.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ commission/              # åˆ†ä½£æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ commission.controller.ts
â”‚       â”‚   â”œâ”€â”€ commission.service.ts
â”‚       â”‚   â”œâ”€â”€ commission-calculation.service.ts
â”‚       â”‚   â”œâ”€â”€ entities/
â”‚       â”‚   â”‚   â”œâ”€â”€ commission-rule.entity.ts       # åˆ†ä½£è§„åˆ™
â”‚       â”‚   â”‚   â””â”€â”€ commission-record.entity.ts    # åˆ†ä½£è®°å½•
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ file/                    # æ–‡ä»¶æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ file.controller.ts
â”‚       â”‚   â”œâ”€â”€ file.service.ts
â”‚       â”‚   â”œâ”€â”€ oss.service.ts
â”‚       â”‚   â”œâ”€â”€ file.entity.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ service-provider/        # æœåŠ¡å•†æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ service-provider.controller.ts
â”‚       â”‚   â”œâ”€â”€ service-provider.service.ts
â”‚       â”‚   â”œâ”€â”€ entities/
â”‚       â”‚   â”‚   â”œâ”€â”€ service-provider.entity.ts     # æœåŠ¡å•†
â”‚       â”‚   â”œâ”€â”€ franchise.entity.ts            # åŠ ç›Ÿå•†
â”‚       â”‚   â”‚   â”œâ”€â”€ channel.entity.ts              # æ¸ é“å•†
â”‚       â”‚   â”‚   â””â”€â”€ dto/
â”‚       â”‚   â”œâ”€â”€ cache.service.ts                      # Redis ç¼“å­˜æœåŠ¡ï¼ˆæ–°å¢ï¼‰
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ bank/                    # é“¶è¡Œæ¨¡å—
â”‚       â”‚   â”œâ”€â”€ bank.controller.ts
â”‚       â”‚   â”œâ”€â”€ bank.service.ts
â”‚       â”‚   â”œâ”€â”€ entities/
â”‚       â”‚   â”œâ”€â”€ bank.entity.ts                 # é“¶è¡Œ
â”‚       â”‚   â””â”€â”€ bank-branch.entity.ts          # é“¶è¡Œåˆ†è¡Œ
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ withdrawal/              # æç°æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ withdrawal.controller.ts
â”‚       â”‚   â”œâ”€â”€ withdrawal.service.ts
â”‚       â”‚   â”œâ”€â”€ withdrawal.entity.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ invitation/              # é‚€è¯·æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ invitation.controller.ts
â”‚       â”‚   â”œâ”€â”€ invitation.service.ts
â”‚       â”‚   â”œâ”€â”€ invitation.entity.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ feedback/                # åé¦ˆæ¨¡å—
â”‚       â”‚   â”œâ”€â”€ feedback.controller.ts
â”‚       â”‚   â”œâ”€â”€ feedback.service.ts
â”‚       â”‚   â”œâ”€â”€ feedback.entity.ts
â”‚   â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ log/                     # æ—¥å¿—æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ log.controller.ts
â”‚       â”‚   â”œâ”€â”€ log.service.ts
â”‚   â”‚   â”œâ”€â”€ operation-log.entity.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ admin/                   # è¿è¥ç®¡ç†æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ admin.controller.ts
â”‚       â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ test/                           # æµ‹è¯•æ–‡ä»¶
â”‚ â”‚   â”œâ”€â”€ unit/                       # å•å…ƒæµ‹è¯•
â”‚       â”‚   â”œâ”€â”€ integration/                # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ e2e/                        # ç«¯åˆ°ç«¯æµ‹è¯•
â”œâ”€â”€ test/
â”œâ”€â”€ .env.example                    # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ .prettierrc                     # Prettieré…ç½®
â”œâ”€â”€ eslint.config.mjs              # ESLinté…ç½®
â”œâ”€â”€ nest-cli.json                   # NestJS CLIé…ç½®
â”œâ”€â”€ tsconfig.json                   # TypeScripté…ç½®
â”œâ”€â”€ package.json                    # é¡¹ç›®ä¾èµ–
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js >= 18.x
- MySQL >= 8.0
- npm >= 9.x

### å®‰è£…ä¾èµ–

```bash
npm install
```

### ç¯å¢ƒé…ç½®

1. å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

2. æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„é…ç½®é¡¹ï¼š

```bash
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
API_PREFIX=api

# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_USERNAME=root
DB_PASSWORD=your_password
DB_DATABASE=yinhang_platform
DB_SYNCHRONIZE=false
DB_LOGGING=true

# JWTé…ç½®
JWT_SECRET=your-super-secret-jwt-key-change-this-in-production
JWT_ACCESS_TOKEN_EXPIRY=15m
JWT_REFRESH_TOKEN_EXPIRY=7d

# å¾®ä¿¡æ”¯ä»˜é…ç½®
WECHAT_PAY_APP_ID=your-wechat-app-id
WECHAT_PAY_MCH_ID=your-mch-id
WECHAT_PAY_API_V3_KEY=your-api-v3-key
WECHAT_PAY_CERT_PATH=/path/to/apiclient_cert.p12
WECHAT_PAY_CERT_SERIAL_NO=your-cert-serial-no
WECHAT_PAY_NOTIFY_URL=https://your-domain.com/api/payment/callback/wechat

# é˜¿é‡Œäº‘OSSé…ç½®
ALIYUN_OSS_REGION=oss-cn-hangzhou
ALIYUN_OSS_ACCESS_KEY_ID=your-access-key-id
ALIYUN_OSS_ACCESS_KEY_SECRET=your-access-key-secret
ALIYUN_OSS_BUCKET=your-bucket-name
ALIYUN_OSS_ENDPOINT=https://oss-cn-hangzhou.aliyuncs.com

# æ–‡ä»¶ä¸Šä¼ é…ç½®
MAX_FILE_SIZE=10485760
ALLOWED_FILE_TYPES=jpg,jpeg,png,pdf

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_TTL=300               # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼Œé»˜è®¤ 5 åˆ†é’Ÿï¼‰
REDIS_KEY_PREFIX=sp:        # ServiceProvider ç¼“å­˜é”®å‰ç¼€
```

### æ•°æ®åº“åˆå§‹åŒ–

1. åˆ›å»ºæ•°æ®åº“ï¼š

```bash
mysql -u root -p "
CREATE DATABASE yinhang_platform CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
"
```

2. åŒæ­¥æ•°æ®åº“ç»“æ„ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼š

```bash
# è®¾ç½® .env ä¸­çš„ DB_SYNCHRONIZE=true
npm run start:dev
```

### è¿è¡Œé¡¹ç›®

```bash
# å¼€å‘æ¨¡å¼ï¼ˆå¸¦çƒ­é‡è½½ï¼‰
npm run start:dev

# è°ƒè¯•æ¨¡å¼
npm run start:debug

# ç”Ÿäº§æ¨¡å¼
npm run build
npm run start:prod
```

### è®¿é—®åº”ç”¨

å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **åº”ç”¨åœ°å€**: http://localhost:3000
- **APIæ–‡æ¡£**: http://localhost:3000/api/docs

## ğŸ“š APIæ–‡æ¡£

é¡¹ç›®é›†æˆäº†Swaggerï¼Œè‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼APIæ–‡æ¡£ã€‚å¯åŠ¨é¡¹ç›®åè®¿é—®ï¼š

```
http://localhost:3000/api/docs
```

### APIæ¨¡å—

| æ¨¡å—     | è·¯å¾„å‰ç¼€          | æè¿°                                             |
| -------- | ----------------- | ------------------------------------------------ |
| è®¤è¯æ¨¡å— | `/api/auth`       | æ³¨å†Œã€ç™»å½•ã€åˆ·æ–°ä»¤ç‰Œã€ç™»å‡º                       |
| ç”¨æˆ·æ¨¡å— | `/api/user`       | ç”¨æˆ·ä¿¡æ¯ã€è§’è‰²åˆ‡æ¢ã€è®¤è¯                         |
| è®¢å•æ¨¡å— | `/api/order`      | å¯¹æ¥è®¢å•ã€å§”æ‰˜è®¢å•ç®¡ç†                           |
| æ”¯ä»˜æ¨¡å— | `/api/payment`    | åˆ›å»ºæ”¯ä»˜ã€æ”¯ä»˜å›è°ƒã€é€€æ¬¾                         |
| æ–‡ä»¶æ¨¡å— | `/api/file`       | æ–‡ä»¶ä¸Šä¼ ã€æ–‡ä»¶ç®¡ç†                               |
| åˆ†ä½£æ¨¡å— | `/api/commission` | åˆ†ä½£è§„åˆ™é…ç½®ã€åˆ†ä½£è®°å½•                           |
| é“¶è¡Œæ¨¡å— | `/api/bank`       | é“¶è¡Œä¿¡æ¯ç®¡ç†                                     |
| æç°æ¨¡å— | `/api/withdrawal` | æç°ç”³è¯·ã€æç°å®¡æ ¸                               |
| é‚€è¯·æ¨¡å— | `/api/invitation` | é‚€è¯·å¥½å‹                                         |
| åé¦ˆæ¨¡å— | `/api/feedback`   | ç”¨æˆ·åé¦ˆç®¡ç†                                     |
| æ—¥å¿—æ¨¡å— | `/api/log`        | æ“ä½œæ—¥å¿—                                         |
| è¿è¥ç®¡ç† | `/api/admin`      | å®¢æˆ·ç®¡ç†ã€æœåŠ¡å•†ç®¡ç†ï¼ˆæ”¯æŒå¤šå±‚çº§æŸ¥è¯¢ï¼‰ã€æ•°æ®ç»Ÿè®¡ |

### å±‚çº§æŸ¥è¯¢ API åˆ—è¡¨

| ç«¯ç‚¹         | æ–¹æ³• | è·¯å¾„                  | æè¿°                                   |
| ------------ | ---- | --------------------- | -------------------------------------- |
| è·å–åä»£èŠ‚ç‚¹ | GET  | `/:id/descendants`    | è·å–æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰åä»£èŠ‚ç‚¹ï¼ˆé€’å½’æŸ¥è¯¢ï¼‰ |
| è·å–ç¥–å…ˆèŠ‚ç‚¹ | GET  | `/:id/ancestors`      | è·å–æŸä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰ç¥–å…ˆèŠ‚ç‚¹ï¼ˆé€’å½’æŸ¥è¯¢ï¼‰ |
| è·å–å®Œæ•´è·¯å¾„ | GET  | `/:id/path`           | è·å–ä»æ ¹åˆ°èŠ‚ç‚¹çš„å®Œæ•´è·¯å¾„               |
| ç»Ÿè®¡å­èŠ‚ç‚¹   | GET  | `/:id/children-stats` | æŒ‰ç±»å‹ç»Ÿè®¡å­èŠ‚ç‚¹æ•°é‡                   |
| æŒ‰ç±»å‹æŸ¥è¯¢   | GET  | `/type/:type`         | æŒ‰ç±»å‹æŸ¥è¯¢èŠ‚ç‚¹ï¼ˆæ”¯æŒåˆ†é¡µï¼‰             |
| è·å–æ ¹èŠ‚ç‚¹   | GET  | `/roots`              | è·å–æ‰€æœ‰æ ¹èŠ‚ç‚¹ï¼ˆFRANCHISEï¼‰            |

## ğŸ§ª æµ‹è¯•

```bash
# å•å…ƒæµ‹è¯•
npm test

# E2Eæµ‹è¯•
npm run test:e2e

# æµ‹è¯•è¦†ç›–ç‡
npm test -- --coverage
```

### æ•°æ®åº“è¿ç§»

ç”±äºé¡¹ç›®ä½¿ç”¨ TypeORM çš„ `synchronize: true` æ¨¡å¼ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼Œå¯åŠ¨æœåŠ¡æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå’ŒåŒæ­¥æ•°æ®åº“ç»“æ„ã€‚

ç”Ÿäº§ç¯å¢ƒéœ€ç¡®ä¿ï¼š

- `DB_SYNCHRONIZE=false`ï¼ˆç¦æ­¢è‡ªåŠ¨åŒæ­¥ï¼‰
- ä½¿ç”¨æ­£å¼çš„æ•°æ®åº“è¿ç§»æ–‡ä»¶ç®¡ç† schema å˜æ›´

### Redis ç¼“å­˜é…ç½®

åœ¨ `.env` æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ Redis é…ç½®é¡¹ï¼š

```bash
# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=              # Redis å¯†ç ï¼ˆå¯é€‰ï¼‰
REDIS_DB=0                  # Redis æ•°æ®åº“ç¼–å·
REDIS_TTL=300               # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼Œé»˜è®¤ 5 åˆ†é’Ÿï¼‰
REDIS_KEY_PREFIX=sp:        # ServiceProvider ç¼“å­˜é”®å‰ç¼€
```

### æ•°æ®åº“è¿ç§»

ç”±äºé¡¹ç›®ä½¿ç”¨ TypeORM çš„ `synchronize: true` æ¨¡å¼ï¼ˆå¼€å‘ç¯å¢ƒï¼‰ï¼Œå¯åŠ¨æœåŠ¡æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºå’ŒåŒæ­¥æ•°æ®åº“ç»“æ„ã€‚

ç”Ÿäº§ç¯å¢ƒéœ€ç¡®ä¿ï¼š

- `DB_SYNCHRONIZE=false`ï¼ˆç”Ÿäº§ç¯å¢ƒç¦æ­¢è‡ªåŠ¨åŒæ­¥ï¼‰
- ä½¿ç”¨æ­£å¼çš„æ•°æ®åº“è¿ç§»æ–‡ä»¶ç®¡ç† schema å˜æ›´

## ğŸš€ éƒ¨ç½²

è¯¦ç»†çš„éƒ¨ç½²è¯´æ˜è¯·å‚è€ƒ [DEPLOYMENT.md](./DEPLOYMENT.md)ã€‚

### æ„å»ºé¡¹ç›®

```bash
npm run build
```

### ç¯å¢ƒå˜é‡

ç”Ÿäº§ç¯å¢ƒåŠ¡å¿…è®¾ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡ï¼Œç‰¹åˆ«æ³¨æ„ï¼š

- `NODE_ENV=production`
- `DB_SYNCHRONIZE=false`ï¼ˆç”Ÿäº§ç¯å¢ƒç¦æ­¢è‡ªåŠ¨åŒæ­¥ï¼‰
- `JWT_SECRET` ä½¿ç”¨å¼ºå¯†ç 
- æ•°æ®åº“è¿æ¥ä½¿ç”¨é«˜æƒé™è´¦å·

### Dockeréƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# æ„å»ºé•œåƒ
docker build -t yinhang-backend .

# è¿è¡Œå®¹å™¨
docker run -d -p 3000:3000 \
  --env-file .env \
  yinhang-backend
```

## ğŸ“Š é¡¹ç›®æ•°æ®

- **ä»£ç è¡Œæ•°**: ~10,000+ è¡Œ
- **æºæ–‡ä»¶æ•°**: 105 ä¸ª
- **æ¨¡å—æ•°**: 11 ä¸ªæ ¸å¿ƒæ¨¡å—
- **APIç«¯ç‚¹**: 50+ ä¸ª
- **å®ä½“æ•°**: 15+ ä¸ªæ•°æ®è¡¨

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šbugæˆ–æå‡ºæ–°åŠŸèƒ½å»ºè®®ï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'feat: Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ä¸“æœ‰è®¸å¯è¯ã€‚

## ğŸ‘¥ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- é¡¹ç›®Issue: [GitHub Issues](https://github.com/yourusername/yinhang-backend/issues)
- é‚®ç®±: your-email@example.com

## ğŸ™ è‡´è°¢

- [NestJS](https://nestjs.com/) - ä¼˜ç§€çš„Node.jsä¼ä¸šçº§æ¡†æ¶
- [TypeORM](https://typeorm.io/) - å¼ºå¤§çš„ORMå·¥å…·
- æ‰€æœ‰è´¡çŒ®è€…

---

<div align="center">

Made with â¤ï¸ by [Your Team Name]

</div>
